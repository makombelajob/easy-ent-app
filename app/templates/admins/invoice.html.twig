{# templates/admins/invoice.html.twig #}
<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8">
		<title>Facture #{{ payment.id }}</title>
		<link rel="stylesheet" href="{{ absolute_url(asset('bootstrap/bootstrap.min.css')) }}">
		<style>
			body {
				font-family: DejaVu Sans, sans-serif;
				font-size: 13px;
			}
			.footer {
				margin-top: 40px;
				text-align: center;
				font-size: 12px;
				color: #555;
			}
		</style>
	</head>
	<body class="bg-white text-dark p-4">

		<div
			class="container">

			<!-- En-tête -->
			<div class="d-flex align-items-center mb-4">
				<img src="{{ absolute_url(asset('images/logo.png')) }}" alt="Logo ENT" style="max-height:60px; margin-right:15px;">
				<div>
					<h2 class="fw-bold mb-0">Facture de Paiement</h2>
					<p class="text-muted mb-0">ENT Facile — Générée automatiquement</p>
				</div>
			</div>

			{% set parent = payment.getParentUsers() %}
			{% set students = parent.getStudents() %}

			<!-- Informations Parent et Élèves -->
			<div class="row mb-4">
				<div class="col-12 col-md-6 mb-3">
					<p>
						<strong>Profession :</strong>
						{{ parent.profession ?? '—' }}</p>
					<p>
						<strong>Lieu de travail :</strong>
						{{ parent.workspace ?? '—' }}</p>
				</div>
				<div class="col-12 col-md-6">
					<p>
						<strong>Élève(s) :</strong>
					</p>
					<ul>
						{% for student in students %}
							{% set user = student.getUsers() %}
							{% if user %}
								<li>{{ user.firstname }}
									{{ user.lastname }}
									—
									{{ student.class }}
									(Niveau
									{{ student.level }})</li>
							{% else %}
								<li class="text-muted">Élève sans compte utilisateur —
									{{ student.class }}
									(Niveau
									{{ student.level }})</li>
							{% endif %}
						{% else %}
							<li class="text-muted">Aucun élève associé</li>
						{% endfor %}
					</ul>
				</div>
			</div>

			<!-- Tableau de tous les paiements du parent -->
			<div class="table-responsive">
				<table class="table table-bordered align-middle">
					<thead class="table-light">
						<tr>
							<th>ID Paiement</th>
							<th>Type</th>
							<th>Description</th>
							<th>Date de création</th>
							<th>Date de paiement</th>
							<th class="text-end">Montant (€)</th>
						</tr>
					</thead>
					<tbody>
						{% set total = 0 %}
						{% for p in parent.getPayments() %}
							{% set total = total + (p.amount + 0) %}
							<tr>
								<td>{{ p.id }}</td>
								<td>{{ p.type }}</td>
								<td>{{ p.description ?? '—' }}</td>
								<td>{{ p.createAt ? p.createAt|date('d/m/Y') : '—' }}</td>
								<td>{{ p.paidAt ? p.paidAt|date('d/m/Y') : '—' }}</td>
								<td class="text-end">{{ p.amount|number_format(2, ',', ' ') }}</td>
							</tr>
						{% else %}
							<tr>
								<td colspan="6" class="text-center text-muted">Aucun paiement trouvé</td>
							</tr>
						{% endfor %}
						<tr class="fw-bold">
							<td colspan="5" class="text-end">Total général</td>
							<td class="text-end">{{ total|number_format(2, ',', ' ') }}
								€</td>
						</tr>
					</tbody>
				</table>
			</div>

			<!-- Pied de page -->
			<footer class="footer">
				Merci pour votre confiance — ENT Facile ©
				{{ "now"|date('Y') }}
			</footer>

		</div>

	</body>
</html>

